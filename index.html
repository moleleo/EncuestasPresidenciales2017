<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <!--script src="https://d3js.org/d3.v4.min.js"></script-->
  <script src="js/d3.v4.min.js"></script>
  <style>
  
    body { 
			margin:0;
			position:fixed;
			top:0;
			right:0;
			bottom:0;
			left:0; 
			font:10px sans-serif; 
		}

    .axisLeft path, .axisLeft line, 
		.axisRight path, .axisRight line, 
		.axisBottom path, .axisBottom line {
      fill: none;
      stroke: #000;
      stroke-width: 2px;
      shape-rendering: crispEdges;
    }
    
		.legend {
			position: absolute;
			width: 350px;
			height: 200px;
			background-color: hsla(0,0%,100%,.9);	
			padding: 5px 10px 5px 10px;
			border-radius: 5px;
		}   

		.swatch {
			width: 14px;
			height: 14px;
			float: left;
			margin-right: 8px;
		} 

		.legendTitle {
			font:15px sans-serif;
			font-weight:bold;  
			margin-bottom: 2px;
		}

		.item {
			font:12px sans-serif;
			float:left;
			margin-top: 6px;
			margin-right:100px;
		}

  </style>
</head>

<body>
<div id="chart"></div>
<br>
<button type="button" onclick="streamGraph()">StreamGraph</button>
<button type="button" onclick="stackedArea()">Stacked Area</button>

  <script>

		var data = [
			{day: new Date(2017, 7, 2),  "Sergio Fajardo": 10.3,  "Germán Vargas Lleras": 5.3,  "Claudia Lopez": 4.9,   "Gustavo Petro":14.3, "Juan Manuel Galán":4.9,  "Clara Lopez":6.7,  "No Sabe - No Responde": 31.4},
			{day: new Date(2017, 7, 23), "Sergio Fajardo": 8,     "Germán Vargas Lleras": 13,   "Claudia Lopez": 10,    "Gustavo Petro":13,   "Juan Manuel Galán":5,    "Clara Lopez":7,    "No Sabe - No Responde": 17},
			{day: new Date(2017, 8, 12), "Sergio Fajardo": 9.6,   "Germán Vargas Lleras": 6.7,  "Claudia Lopez": 5.3,   "Gustavo Petro":11.2, "Juan Manuel Galán":5.6,  "Clara Lopez":8.3,  "No Sabe - No Responde": 29.9},
			{day: new Date(2017, 8, 20), "Sergio Fajardo": 7,     "Germán Vargas Lleras": 11,   "Claudia Lopez": 6,     "Gustavo Petro":9,    "Juan Manuel Galán":4,    "Clara Lopez":5,    "No Sabe - No Responde": 13},
			{day: new Date(2017, 8, 28), "Sergio Fajardo": 21,    "Germán Vargas Lleras": 12.5, "Claudia Lopez": 11.2,  "Gustavo Petro":10.2, "Juan Manuel Galán":8.8,  "Clara Lopez":3.2,  "No Sabe - No Responde": 0},
			{day: new Date(2017, 8, 29), "Sergio Fajardo": 21,    "Germán Vargas Lleras": 12.5, "Claudia Lopez": 11.2,  "Gustavo Petro":10.2, "Juan Manuel Galán":8.8,  "Clara Lopez":3.2,  "No Sabe - No Responde": 0}
		]; 
	
		var margin = {top: 20, right: 450, bottom: 30, left: 50};

		var width = document.body.clientWidth - margin.left - margin.right;
		var height = 350 - margin.top - margin.bottom;    
	
		var area = d3.area()
			.x(function(d) { return x(d.data.day); })
			.y0(function(d) { return y(d[0]); })
			.y1(function(d) { return y(d[1]); })
			.curve(d3.curveCatmullRom);
			//.curve(d3.curveMonotoneX);
			//.curve(d3.curveCardinal);
			//.curve(d3.curveStep);
			//.curve(d3.curveBasis);

//		var xAxis = d3.axisBottom(x);
			
		function createLegend() {
		
      var legend = [];
			
      d3.select("#chart").append("div")
        .attr("class", "legend")
        .style("top", "65px")
        .style("right", "30px") 
        .append("div")
          .attr("class", "legendTitle")
          .text("Candidato");

      series.forEach(function(d,i){
        var obj = {};
        obj.key = d.key;
        obj.color = color(i);
        legend.push(obj);
      });  
        
      legend.forEach(function(d,i){
        d3.select(".legend").append("div")
          .attr("class", "item")
          .text(d.key)
        .append("div")
          .attr("class", "swatch")
          .style("background",  d.color);
      });   
			
		}
	
    function streamGraph( ) { 

      var tooltip = d3.select("body")
        .append("div")
        .attr("class", "remove")
        .style("position", "absolute")
        .style("z-index", "20")
        .style("visibility", "hidden")
        .style("top", "30px")
        .style("left", "65px");
      
      color = d3.scaleOrdinal(d3.schemeCategory10);	      

      var datearray = [];

      stack = d3.stack()
        .keys(["Sergio Fajardo", "Germán Vargas Lleras", "Claudia Lopez", "Gustavo Petro", "Juan Manuel Galán", "Clara Lopez", "No Sabe - No Responde"])
        .order(d3.stackOrderReverse)
        //.order(d3.stackOrderNone)
        .offset(d3.stackOffsetWiggle);
				//.offset(d3.stackOffsetNone);				
              
      series = stack(data);
              
      x = d3.scaleTime()
        .domain([new Date(2017, 7, 1), new Date(2017, 8, 30)])
        .range([0, width]);

      y = d3.scaleLinear()
        .domain([0, 100])
        .range([height-5, 0]);
				
      d3.select("svg").remove().exit();

      svg = d3.select("#chart").append("svg")
        .attr("width", width + (margin.left*2))
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");  

      svg.selectAll(".layer")
        .data(series)
        .enter().append("path")
          .attr("cursor", "crosshair")
          .attr("class", "layer")
          .attr("d", function(d) {
            return area(d); 
          })
          .style("fill", function(d, i) { return color(i); });

      svg.append("g")
        .attr("class", "axisBottom")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));   

      svg.append("g")
        .attr("class", "axisLeft")
        .call(d3.axisLeft(y));     

      svg.append("g")
        .attr("class", "axisRight")
        .attr("transform", "translate(" + width + ",0)")
        .call(d3.axisRight(y));    

      var val;

      svg.selectAll(".layer")
        .attr("opacity", 1)
        .on("mouseover", function(d, i) {
          svg.selectAll(".layer").transition()
          .duration(250)
          .attr("opacity", function(d, j) {
            return j != i ? 0.4 : 1;
          })
        })
        .on("mousemove", function(d, i) {
          mousex = d3.mouse(this);
          mousex = mousex[0];
          var invertedx = x.invert(mousex);
          year = invertedx.getYear() + 1900;
          month = invertedx.getMonth() + 1;
          day = invertedx.getDate();  
          invertedx =  "" + year + month + day;
          var selected = (d);
          for (var k = 0; k < selected.length; k++) {
            year = selected[k].data.day.getYear() + 1900;
            month = selected[k].data.day.getMonth() + 1;
            day = selected[k].data.day.getDate();
            datearray[k] =  "" + year + month + day;
          }
          mousedate = datearray.indexOf(invertedx);
          if ( mousedate > -1) {
            var val = d[mousedate][1] - d[mousedate][0];
            val = val.toFixed(1);
            d3.select(this)
              .classed("hover", true)
              .attr("stroke-width", "5.5px"), 
              tooltip.html( "<p>" + d.key + "<br>" + val + "</p>" ).style("visibility", "visible");
          }
        })
        .on("mouseout", function(d, i) {
          svg.selectAll(".layer")
            .transition()
            .duration(250)
            .attr("opacity", "1");
          d3.select(this)
            .classed("hover", false)
            .attr("stroke-width", "0px"), tooltip.html( "<p>" + d.key + "<br>" + val + "</p>" ).style("visibility", "hidden");
        }); 
				
        d3.selectAll(".remove").remove().exit();
          
        vertical = d3.select("body").append("div")
          .attr("class", "remove")
          //.attr('width', width * 0.98)
          .style("position", "absolute")
          .style("z-index", "20")
          .style("width", "0.5px")
          .style("height", (height-4) +  "px")
          .style("top", (margin.top) + "px")
          .style("bottom", margin.bottom + "px")
          .style("background", "#fcfcfc");
          //.style("background", "#000");  
            
        //d3.select(".leonardo") //body
        d3.select("svg") //body
        .on("mousemove", function(){ 
          mousex = d3.mouse(this);
          mousex = mousex[0] + 5;
          vertical.style("left", mousex + "px" );
        })
        .on("mouseover", function(){ 
          mousex = d3.mouse(this);
          mousex = mousex[0] + 5;
          vertical.style("left", mousex + "px");
        });    
                 
        var curtain = svg.append('rect')
          .attr('x', -0.99 * width)
          .attr('y', -0.99 * height)
          .attr('height', height)
          .attr('width', width * 0.98)
          .attr('class', 'curtain')
          .attr("transform", "translate(" + width + "," + height + ")")  
          .attr('transform', 'rotate(180)')
          //.style('fill', 'lightgray')
          .style('fill', '#fcfcfc')    
          .transition()
            .delay(1000)
            .duration(1500)          
            .attr('width', 0);  
			
    }

		var svg; 
		var stack;
		var x;
		var y;
		var color;	      
		var series;
		
    streamGraph();  
		createLegend();
		
		function stackedArea() {

      stack.offset(d3.stackOffsetNone);				
      series = stack(data);	
			
			/*
      stack = d3.stack()
        .keys(["Sergio Fajardo", "Germán Vargas Lleras", "Claudia Lopez", "Gustavo Petro", "Juan Manuel Galán", "Clara Lopez", "No Sabe - No Responde"])
        .order(d3.stackOrderReverse)
        //.order(d3.stackOrderNone)
        .offset(d3.stackOffsetWiggle);
				//.offset(d3.stackOffsetNone);				
              
      series = stack(data);
			*/
			
		
      x.domain([new Date(2017, 7, 1), new Date(2017, 9, 30)])
      y.domain([0, 200]);

      svg = d3.select("#chart").transition();

			/*
			svg.select(".line")   // change the line
				.duration(750)
				.attr("d", valueline(data));
			*/
			
			console.log(series);
			
      svg.select(".layer")
				.duration(750)
				.call(area(series));
				
//				.attr("d", function(series) {
//            return area(series); 
//				});
				
/*

      svg.selectAll(".layer")
        .data(series)
        .enter().append("path")
          .attr("cursor", "crosshair")
          .attr("class", "layer")
          .attr("d", function(d) {
            return area(d); 
          })
          .style("fill", function(d, i) { return color(i); });

*/				
			
			svg.select(".axisBottom") // change the x axis
				.duration(750)
				.call(d3.axisBottom(x));

			svg.select(".axisLeft") // change the y axis
				.duration(750)
				.call(d3.axisLeft(y));

			svg.select(".axisRight") // change the y axis
				.duration(750)
				.call(d3.axisRight(y));
		
/*		
      stack.offset(d3.stackOffsetNone);				
      series = stack(data);	
			
      var layers = svg.selectAll(".layer")	
				.remove()
				.exit()
				.data(series);		

        layers.enter().append("path")
          .attr("cursor", "crosshair")
          .attr("class", "layer")
          .attr("d", function(d) {
            return area(d); 
          })
          .style("fill", function(d, i) { return color(i); });
*/



				

				
/*				


      svg = svg.selectAll(".layer");
				
      svg.selectAll(".layer")
        .attr("opacity", 0.1);


      svg.selectAll(".layer")
        .attr("opacity", 1)
        .on("mouseover", function(d, i) {
					console.log("sadsadad");
          svg.selectAll(".layer").transition()
          .duration(250)
          .attr("opacity", function(d, j) {
            return j != i ? 0.4 : 1;
          })
        })
        .on("mousemove", function(d, i) {
          mousex = d3.mouse(this);
          mousex = mousex[0];
          var invertedx = x.invert(mousex);
          year = invertedx.getYear() + 1900;
          month = invertedx.getMonth() + 1;
          day = invertedx.getDate();  
          invertedx =  "" + year + month + day;
          var selected = (d);
          for (var k = 0; k < selected.length; k++) {
            year = selected[k].data.day.getYear() + 1900;
            month = selected[k].data.day.getMonth() + 1;
            day = selected[k].data.day.getDate();
            datearray[k] =  "" + year + month + day;
          }
          mousedate = datearray.indexOf(invertedx);
          if ( mousedate > -1) {
            var val = d[mousedate][1] - d[mousedate][0];
            val = val.toFixed(1);
            d3.select(this)
              .classed("hover", true)
              .attr("stroke-width", "5.5px"), 
              tooltip.html( "<p>" + d.key + "<br>" + val + "</p>" ).style("visibility", "visible");
          }
        })
        .on("mouseout", function(d, i) {
          svg.selectAll(".layer")
            .transition()
            .duration(250)
            .attr("opacity", "1");
          d3.select(this)
            .classed("hover", false)
            .attr("stroke-width", "0px"), tooltip.html( "<p>" + d.key + "<br>" + val + "</p>" ).style("visibility", "hidden");
        }); 
				

*/					
			
	//			.duration(2000)
//				.attr("d", function(d) { return area(d); });
				

/*
      svg.selectAll(".layer")
        .data(series)
        .enter().append("path")
          .attr("cursor", "crosshair")
          .attr("class", "layer")
          .attr("d", function(d) {
            return area(d); 
          })
          .style("fill", function(d, i) { return color(i); });

*/
				
			
			//alert('Hello world!!!!');
					
			console.log("?.?..?...");
			
		}
            
  </script>
</body>